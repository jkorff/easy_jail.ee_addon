!function(e,t){var i=t(jQuery),a="function"==typeof define&&define.amd;a?define(e,["jquery"],i):(this.jQuery||this.$||this)[e]=i}("jail",function(e){function t(e,t){var i=!1;t&&(i=t.data("triggerElem")),i&&"function"==typeof i.on&&(i.on(e.event+"."+e.id,{options:e,images:t},a),f.on("resize."+e.id,{options:e,images:t},a))}function i(t){var i=0;if(0!==t.length)for(;;){if(i===t.length)break;e(t[i]).attr("data-src")?i++:t.splice(i,1)}}function a(a){var o=a.data.images,l=a.data.options;o.data("poller",setTimeout(function(){if(u=e.extend({},o),i(u),e(u).each(function(){this!==window&&n(l,this,u)}),r(u))return void e(a.currentTarget).unbind(a.type+"."+l.id);if("scroll"!==l.event){var c=/scroll/i.test(l.event)?o.data("triggerElem"):f;l.event="scroll",o.data("triggerElem",c),t(l,e(u))}},l.timeout))}function r(t){var i=!0;return e(t).each(function(){e(this).attr("data-src")&&(i=!1)}),i}function n(t,i,a){var r=e(i),n=/scroll/i.test(t.event)?a.data("triggerElem"):f,c=!0;t.loadHiddenImages||(c=s(r,n,t)&&r.is(":visible")),c&&o(n,r,t.offset)&&l(t,r)}function o(e,t,i){var a=e[0]===window,r=a?{top:0,left:0}:e.offset(),n=r.top+(a?e.scrollTop():0),o=r.left+(a?e.scrollLeft():0),l=o+e.width(),c=n+e.height(),s=t.offset(),f=t.width(),d=t.height();return n-i<=s.top+d&&c+i>=s.top&&o-i<=s.left+f&&l+i>=s.left}function l(t,i){if("IMG"==i[0].nodeName){var a=new Image;a.onload=function(){void 0!==i.attr("data-src")&&c(a,i,t)},a.onerror=function(){if("error"in t){var a=Array.prototype.slice.call(arguments,0);a=[i,t].concat(a),t.error.apply(e.jail,a)}},a.src=i.attr("data-src")}else if("IFRAME"==i[0].nodeName){if(e('iframe[src="'+i.attr("data-src")+'"]').length>0)return;var r=document.createElement("iframe");document.body.appendChild(r),e(r).load(function(){c(r,i,t)}),r.src=i.attr("data-src")}}function c(t,a,n){a.hide().attr("src",t.src),a.removeAttr("data-src"),n.effect?(n.speed?a[n.effect](n.speed):a[n.effect](),a.css("opacity",1),a.show()):a.show(),e(t).remove(),i(u),n.callbackAfterEachImage&&n.callbackAfterEachImage.call(this,a,n),r(u)&&n.callback&&!p&&(n.callback.call(e.jail,n),p=!0)}function s(i,a,r){for(var n=i.parent(),l=!0;n.length&&"BODY"!==n.get(0).nodeName.toUpperCase();){if("hidden"===n.css("overflow")){if(!o(n,i,r.offset)){l=!1;break}}else if("scroll"===n.css("overflow")&&!o(n,i,r.offset)){l=!1,e(u).data("triggerElem",n),r.event="scroll",t(r,e(u));break}if("hidden"===n.css("visibility")||"hidden"===i.css("visibility")){l=!1;break}if(a!==f&&n===a)break;n=n.parent()}return l}var f=e(window),d={id:"jail",timeout:1,effect:!1,speed:400,triggerElement:null,offset:0,event:"load",callback:null,callbackAfterEachImage:null,placeholder:!1,loadHiddenImages:!1},u=[],p=!1;return e.jail=function(t,i){var a=t||{},r=e.extend({},d,i);e.jail.prototype.init(a,r),/^(load|scroll)/.test(r.event)?e.jail.prototype.later.call(a,r):e.jail.prototype.onEvent.call(a,r)},e.jail.prototype.init=function(t,i){t.data("triggerElem",i.triggerElement?e(i.triggerElement):f),i.placeholder&&t.each(function(){e(this).attr("src",i.placeholder)})},e.jail.prototype.onEvent=function(i){var a=this;i.triggerElement?t(i,a):a.on(i.event+"."+i.id,{options:i,images:a},function(t){var i=e(this),a=t.data.options,r=t.data.images;u=e.extend({},r),l(a,i),e(t.currentTarget).unbind(t.type+"."+a.id)})},e.jail.prototype.later=function(i){var a=this;setTimeout(function(){u=e.extend({},a),a.each(function(){n(i,this,a)}),i.event="scroll",t(i,a)},i.timeout)},e.fn.jail=function(t){return new e.jail(this,t),u=[],this},e.jail});